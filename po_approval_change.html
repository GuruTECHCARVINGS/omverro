<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PO Approval & Change Approval - Buyer Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body{font-family:'Inter',sans-serif}
    .card{transition:transform .2s ease, box-shadow .2s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 10px 25px rgba(0,0,0,.07)}
    .gradient-blue{background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%)}
    .gradient-green{background:linear-gradient(135deg,#10b981 0%,#059669 100%)}
    .gradient-purple{background:linear-gradient(135deg,#8b5cf6 0%,#7c3aed 100%)}
    .gradient-red{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%)}
    .badge{padding:.25rem .5rem; border-radius:9999px; font-size:.75rem; font-weight:600}
    .pill{padding:.125rem .5rem; border-radius:9999px; font-size:.75rem; font-weight:600}
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between">
        <div class="flex items-center">
          <button class="mr-3 p-2 rounded-lg hover:bg-gray-100" title="Back to Buyer Dashboard (Alt+B)" onclick="navBack()">
            <i class="fas fa-arrow-left text-gray-600"></i>
          </button>
          <h1 class="text-xl font-semibold text-gray-900">PO Approval & Change Approval</h1>
          <span class="ml-3 badge bg-orange-100 text-orange-800"><i class="fas fa-bell mr-1"></i><span id="pendingCount">6</span> Pending</span>
        </div>
        <div class="flex items-center gap-2">
          <button class="p-2 rounded-lg hover:bg-gray-100" title="Export"><i class="fas fa-download text-gray-600"></i></button>
          <button class="p-2 rounded-lg hover:bg-gray-100" title="Settings"><i class="fas fa-cog text-gray-600"></i></button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumb -->
    <nav class="flex mb-6" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
          <button onclick="navBack()" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
            <i class="fas fa-home w-4 h-4 mr-2"></i>Buyer Dashboard
          </button>
        </li>
        <li class="inline-flex items-center text-sm text-gray-500">
          <i class="fas fa-chevron-right w-4 h-4 text-gray-400 mx-1"></i>
          PO Approval & Change Approval
        </li>
      </ol>
    </nav>

    <!-- Metrics -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-xl p-6 card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Pending POs</p>
            <p class="text-3xl font-bold text-orange-600" id="mPending">6</p>
            <p class="text-xs text-orange-600">Need action today</p>
          </div>
          <div class="p-3 bg-orange-100 rounded-full"><i class="fas fa-clock text-orange-600"></i></div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-6 card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Approved Today</p>
            <p class="text-3xl font-bold text-green-600" id="mApproved">9</p>
            <p class="text-xs text-green-600">Processed</p>
          </div>
          <div class="p-3 bg-green-100 rounded-full"><i class="fas fa-check-circle text-green-600"></i></div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-6 card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Change Requests</p>
            <p class="text-3xl font-bold text-purple-600" id="mChanges">3</p>
            <p class="text-xs text-purple-600">Awaiting review</p>
          </div>
          <div class="p-3 bg-purple-100 rounded-full"><i class="fas fa-pen-to-square text-purple-600"></i></div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-6 card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Pending Value</p>
            <p class="text-3xl font-bold text-blue-600" id="mValue">₹62.7L</p>
            <p class="text-xs text-blue-600">To be approved</p>
          </div>
          <div class="p-3 bg-blue-100 rounded-full"><i class="fas fa-indian-rupee-sign text-blue-600"></i></div>
        </div>
      </div>
    </section>

    <!-- Filters & Actions -->
    <section class="bg-white rounded-xl p-6 card mb-8">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 flex-1">
          <div>
            <label class="text-sm text-gray-600">Status</label>
            <select id="fStatus" class="w-full border rounded-lg p-2">
              <option value="">All</option>
              <option>Pending</option>
              <option>Overdue</option>
              <option>Escalated</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-600">Priority</label>
            <select id="fPriority" class="w-full border rounded-lg p-2">
              <option value="">All</option>
              <option>Urgent</option>
              <option>High</option>
              <option>Medium</option>
              <option>Low</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-600">Department</label>
            <select id="fDept" class="w-full border rounded-lg p-2">
              <option value="">All</option>
              <option>IT</option>
              <option>Operations</option>
              <option>Marketing</option>
              <option>Finance</option>
              <option>HR</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-600">Vendor</label>
            <input id="fVendor" class="w-full border rounded-lg p-2" placeholder="Search vendor" />
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button class="px-3 py-2 gradient-blue text-white rounded-lg hover:opacity-90" onclick="applyFilters()"><i class="fas fa-filter mr-2"></i>Apply</button>
          <button class="px-3 py-2 border rounded-lg hover:bg-gray-50" onclick="resetFilters()">Reset</button>
        </div>
      </div>
    </section>

    <!-- PO Approval Table -->
    <section class="bg-white rounded-xl overflow-hidden card mb-8">
      <div class="px-6 py-4 border-b flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-900"><i class="fas fa-list-check mr-2 text-blue-600"></i>Purchase Orders Awaiting Approval</h3>
        <div class="flex items-center gap-2">
          <button class="px-3 py-2 gradient-green text-white rounded-lg hover:opacity-90" onclick="bulkApprove()"><i class="fas fa-check-double mr-2"></i>Bulk Approve</button>
          <button class="px-3 py-2 gradient-red text-white rounded-lg hover:opacity-90" onclick="bulkReject()"><i class="fas fa-xmark mr-2"></i>Bulk Reject</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left"><input type="checkbox" id="selAll" class="rounded border-gray-300" onchange="toggleAll()" /></th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">PO</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Vendor</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Department</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Amount</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Priority</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Status</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Due</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Actions</th>
            </tr>
          </thead>
          <tbody id="poTable" class="bg-white divide-y"></tbody>
        </table>
      </div>
    </section>

    <!-- Change Approval Cards -->
    <section class="bg-white rounded-xl p-6 card">
      <h3 class="text-lg font-semibold text-gray-900 mb-4"><i class="fas fa-arrows-rotate mr-2 text-purple-600"></i>Change Approval Requests</h3>
      <div id="changeCards" class="grid grid-cols-1 lg:grid-cols-2 gap-6"></div>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-gray-700/50 z-50">
    <div class="relative max-w-4xl mx-auto bg-white rounded-xl shadow-xl mt-16 max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between px-6 py-4 border-b">
        <h3 class="text-lg font-semibold" id="modalTitle">Details</h3>
        <button class="p-2 hover:bg-gray-100 rounded-lg" onclick="closeModal()"><i class="fas fa-times"></i></button>
      </div>
      <div id="modalBody" class="p-6"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="hidden fixed top-4 right-4 text-white px-4 py-2 rounded-lg shadow-lg"></div>

  <script>
    const Rs = n => '₹' + (Number(n)||0).toLocaleString('en-IN');
    const el = id => document.getElementById(id);

    function navBack(){ try{ showToast('Back to Buyer Dashboard','info'); setTimeout(()=>location.href='BuyerDashboard.html',350);}catch{ history.back(); } }

    const pos = [
      { id:'PO-2025-0826-1201', vendor:'TechNova Solutions', department:'IT', amount: 245000, priority:'Urgent', status:'Pending', due:'2025-08-27', items:[{desc:'Dell Latitude 5410', qty:10, price:45000, tax:18}] },
      { id:'PO-2025-0826-1207', vendor:'GreenLeaf Supplies', department:'Operations', amount: 35000, priority:'Medium', status:'Pending', due:'2025-08-29', items:[{desc:'Office Supplies', qty:1, price:35000, tax:12}] },
      { id:'PO-2025-0826-1215', vendor:'Omega Hardware', department:'HR', amount: 125000, priority:'High', status:'Overdue', due:'2025-08-24', items:[{desc:'Ergonomic Chairs', qty:20, price:4800, tax:12}] },
      { id:'PO-2025-0826-1220', vendor:'TechNova Solutions', department:'IT', amount: 185000, priority:'High', status:'Pending', due:'2025-08-28', items:[{desc:'HP DL360 Server', qty:1, price:185000, tax:18}] },
      { id:'PO-2025-0826-1229', vendor:'PrintWorks', department:'Marketing', amount: 58000, priority:'Low', status:'Pending', due:'2025-09-02', items:[{desc:'Campaign Collateral', qty:1, price:58000, tax:12}] },
      { id:'PO-2025-0826-1233', vendor:'LogiTrans', department:'Finance', amount: 82000, priority:'Medium', status:'Escalated', due:'2025-08-26', items:[{desc:'Courier Services', qty:1, price:82000, tax:18}] }
    ];

    const changes = [
      { id:'PO-2025-0826-1155', vendor:'TechNova Solutions', field:'Amount', from: '₹1,50,000', to: '₹1,80,000', reason:'Additional licenses required', requester:'John Smith', date:'2025-08-25' },
      { id:'PO-2025-0826-1191', vendor:'GreenLeaf Supplies', field:'Delivery Date', from: '2025-09-01', to: '2025-08-28', reason:'Urgent deployment needs', requester:'Sarah Wilson', date:'2025-08-25' },
      { id:'PO-2025-0826-1197', vendor:'Omega Hardware', field:'Items', from: 'Chairs x 18', to: 'Chairs x 20', reason:'Headcount increase', requester:'Michael Chen', date:'2025-08-24' }
    ];

    function loadPOs(){
      const tb = el('poTable'); tb.innerHTML='';
      pos.forEach(p=>{
        const tr = document.createElement('tr'); tr.className='hover:bg-gray-50';
        const overdue = new Date(p.due) < new Date();
        tr.innerHTML = `
          <td class='px-4 py-3'><input type='checkbox' class='rowSel rounded border-gray-300' value='${p.id}'/></td>
          <td class='px-6 py-3'>
            <div class='font-medium text-gray-900'>${p.id}</div>
            <div class='text-sm text-gray-600'>${p.items[0]?.desc||''}</div>
          </td>
          <td class='px-6 py-3 text-sm'>${p.vendor}</td>
          <td class='px-6 py-3 text-sm text-gray-600'>${p.department}</td>
          <td class='px-6 py-3 font-semibold'>${Rs(p.amount)}</td>
          <td class='px-6 py-3'>${badgePriority(p.priority)}</td>
          <td class='px-6 py-3'>${badgeStatus(p.status)}</td>
          <td class='px-6 py-3 text-sm'>${new Date(p.due).toLocaleDateString('en-IN')}${overdue?"<div class='text-xs text-red-600'>Overdue</div>":''}</td>
          <td class='px-6 py-3'>
            <div class='flex items-center gap-2'>
              <button class='text-blue-600 hover:text-blue-800' title='View' onclick="viewPO('${p.id}')"><i class='fas fa-eye'></i></button>
              <button class='text-green-600 hover:text-green-800' title='Approve' onclick="approvePO('${p.id}')"><i class='fas fa-check'></i></button>
              <button class='text-purple-600 hover:text-purple-800' title='Request Changes' onclick="requestPOChanges('${p.id}')"><i class='fas fa-pen-to-square'></i></button>
              <button class='text-red-600 hover:text-red-800' title='Reject' onclick="rejectPO('${p.id}')"><i class='fas fa-xmark'></i></button>
            </div>
          </td>`;
        tb.appendChild(tr);
      });
    }

    function badgePriority(p){
      const map={Urgent:'bg-red-100 text-red-800',High:'bg-orange-100 text-orange-800',Medium:'bg-blue-100 text-blue-800',Low:'bg-green-100 text-green-800'};
      return `<span class='pill ${map[p]||"bg-gray-100 text-gray-800"}'>${p}</span>`;
    }
    function badgeStatus(s){
      const map={Pending:'bg-yellow-100 text-yellow-800',Overdue:'bg-red-100 text-red-800',Escalated:'bg-purple-100 text-purple-800',Approved:'bg-green-100 text-green-800'};
      return `<span class='pill ${map[s]||"bg-gray-100 text-gray-800"}'>${s}</span>`;
    }

    function loadChangeCards(){
      const wrap = el('changeCards'); wrap.innerHTML='';
      changes.forEach(c=>{
        const div = document.createElement('div');
        div.className = 'border rounded-xl p-5 bg-purple-50 border-purple-200';
        div.innerHTML = `
          <div class='flex items-center justify-between mb-3'>
            <div class='font-semibold text-gray-900'>${c.id} • ${c.vendor}</div>
            <span class='badge bg-purple-100 text-purple-800'>Change</span>
          </div>
          <div class='grid grid-cols-2 gap-4 mb-3 text-sm'>
            <div><div class='text-gray-600'>Field</div><div class='font-medium'>${c.field}</div></div>
            <div><div class='text-gray-600'>Requested By</div><div class='font-medium'>${c.requester}</div></div>
            <div><div class='text-gray-600'>From</div><div class='font-medium'>${c.from}</div></div>
            <div><div class='text-gray-600'>To</div><div class='font-medium'>${c.to}</div></div>
            <div><div class='text-gray-600'>Date</div><div class='font-medium'>${new Date(c.date).toLocaleDateString('en-IN')}</div></div>
          </div>
          <div class='bg-white border rounded p-3 mb-4'>
            <div class='text-sm text-gray-700'><span class='font-medium'>Reason:</span> ${c.reason}</div>
          </div>
          <div class='flex items-center gap-2'>
            <button class='flex-1 px-3 py-2 gradient-green text-white rounded-lg hover:opacity-90' onclick="approveChange('${c.id}')"><i class='fas fa-check mr-2'></i>Approve Change</button>
            <button class='flex-1 px-3 py-2 gradient-red text-white rounded-lg hover:opacity-90' onclick="rejectChange('${c.id}')"><i class='fas fa-xmark mr-2'></i>Reject</button>
            <button class='px-3 py-2 gradient-blue text-white rounded-lg hover:opacity-90' onclick="askMore('${c.id}')"><i class='fas fa-question mr-2'></i>More Info</button>
          </div>`;
        wrap.appendChild(div);
      });
    }

    // Actions
    function toggleAll(){ const a=el('selAll').checked; document.querySelectorAll('.rowSel').forEach(cb=>cb.checked=a); }
    function bulkApprove(){ const n=[...document.querySelectorAll('.rowSel:checked')].length; if(!n){showToast('Select POs','warning'); return;} showToast(`${n} POs approved`,'success'); }
    function bulkReject(){ const n=[...document.querySelectorAll('.rowSel:checked')].length; if(!n){showToast('Select POs','warning'); return;} showToast(`${n} POs rejected`,'info'); }

    function viewPO(id){
      const p = pos.find(x=>x.id===id); if(!p) return;
      const body = `
        <div class='space-y-3'>
          <div class='bg-blue-50 border border-blue-200 p-3 rounded'>
            <div class='font-semibold text-blue-900'>${p.id}</div>
            <div class='text-sm text-blue-700'>${p.vendor} • ${p.department} • ${new Date(p.due).toLocaleDateString('en-IN')}</div>
          </div>
          <div class='overflow-x-auto'>
            <table class='w-full text-sm'>
              <thead class='bg-gray-50'><tr><th class='px-3 py-2 text-left'>Description</th><th class='px-3 py-2 text-left'>Qty</th><th class='px-3 py-2 text-left'>Price</th><th class='px-3 py-2 text-left'>Tax%</th><th class='px-3 py-2 text-left'>Line Total</th></tr></thead>
              <tbody>
                ${p.items.map(i=>{ const line=i.qty*i.price; const tx=line*i.tax/100; return `<tr class='border-b'><td class='px-3 py-2'>${i.desc}</td><td class='px-3 py-2'>${i.qty}</td><td class='px-3 py-2'>${Rs(i.price)}</td><td class='px-3 py-2'>${i.tax}%</td><td class='px-3 py-2 font-semibold'>${Rs(line+tx)}</td></tr>`; }).join('')}
              </tbody>
            </table>
          </div>
          <div class='flex justify-end gap-2'>
            <button class='px-3 py-2 gradient-green text-white rounded-lg hover:opacity-90' onclick="approvePO('${p.id}',true)"><i class='fas fa-check mr-2'></i>Approve</button>
            <button class='px-3 py-2 gradient-purple text-white rounded-lg hover:opacity-90' onclick="requestPOChanges('${p.id}',true)"><i class='fas fa-pen-to-square mr-2'></i>Request Changes</button>
            <button class='px-3 py-2 gradient-red text-white rounded-lg hover:opacity-90' onclick="rejectPO('${p.id}',true)"><i class='fas fa-xmark mr-2'></i>Reject</button>
          </div>
        </div>`;
      el('modalTitle').textContent = 'PO Details'; el('modalBody').innerHTML = body; openModal();
    }

    function approvePO(id, inModal){
      const p = pos.find(x=>x.id===id); if(!p) return;
      const body = `
        <div class='space-y-4 max-w-2xl mx-auto'>
          <div class='bg-green-50 border border-green-200 p-3 rounded'>
            <div class='font-semibold text-green-900'>Approve PO</div>
            <div class='text-sm text-green-700'>${p.id} • ${p.vendor}</div>
          </div>
          <div>
            <label class='block text-sm font-medium text-gray-700 mb-1'>Approval Comments</label>
            <textarea class='w-full border rounded-lg p-2' rows='3' placeholder='Add optional comments'></textarea>
          </div>
          <div class='grid grid-cols-2 gap-4'>
            <div>
              <label class='block text-sm font-medium text-gray-700 mb-1'>Approval Level</label>
              <select class='w-full border rounded-lg p-2'><option>Manager</option><option>Director</option><option>CFO</option></select>
            </div>
            <div class='flex items-center pt-6'>
              <label class='inline-flex items-center text-sm text-gray-700'><input type='checkbox' class='mr-2'/> I confirm authority to approve</label>
            </div>
          </div>
          <div class='flex justify-end gap-2'>
            <button class='px-3 py-2 border rounded-lg hover:bg-gray-50' onclick='closeModal()'>Cancel</button>
            <button class='px-3 py-2 gradient-green text-white rounded-lg hover:opacity-90' onclick="finishApprove('${p.id}')"><i class='fas fa-check mr-2'></i>Approve</button>
          </div>
        </div>`;
      el('modalTitle').textContent = 'Approve PO'; el('modalBody').innerHTML = body; openModal();
    }

    function finishApprove(id){ closeModal(); showToast(`${id} approved`,'success'); }

    function rejectPO(id){
      const p = pos.find(x=>x.id===id); if(!p) return;
      const body = `
        <div class='space-y-4 max-w-2xl mx-auto'>
          <div class='bg-red-50 border border-red-200 p-3 rounded'>
            <div class='font-semibold text-red-900'>Reject PO</div>
            <div class='text-sm text-red-700'>${p.id} • ${p.vendor}</div>
          </div>
          <div>
            <label class='block text-sm font-medium text-gray-700 mb-1'>Reason</label>
            <select class='w-full border rounded-lg p-2'><option value=''>Select reason</option><option>Budget constraints</option><option>Policy violation</option><option>Incorrect specs</option><option>Duplicate</option><option>Other</option></select>
          </div>
          <div>
            <label class='block text-sm font-medium text-gray-700 mb-1'>Comments</label>
            <textarea class='w-full border rounded-lg p-2' rows='3' placeholder='Provide details'></textarea>
          </div>
          <div class='flex justify-end gap-2'>
            <button class='px-3 py-2 border rounded-lg hover:bg-gray-50' onclick='closeModal()'>Cancel</button>
            <button class='px-3 py-2 gradient-red text-white rounded-lg hover:opacity-90' onclick="finishReject('${p.id}')"><i class='fas fa-xmark mr-2'></i>Reject</button>
          </div>
        </div>`;
      el('modalTitle').textContent = 'Reject PO'; el('modalBody').innerHTML = body; openModal();
    }

    function finishReject(id){ closeModal(); showToast(`${id} rejected`,'info'); }

    function requestPOChanges(id){
      const p = pos.find(x=>x.id===id); if(!p) return;
      const body = `
        <div class='space-y-4 max-w-2xl mx-auto'>
          <div class='bg-purple-50 border border-purple-200 p-3 rounded'>
            <div class='font-semibold text-purple-900'>Request Changes</div>
            <div class='text-sm text-purple-700'>${p.id} • ${p.vendor}</div>
          </div>
          <div class='grid grid-cols-2 gap-4'>
            <label class='inline-flex items-center text-sm text-gray-700'><input type='checkbox' class='mr-2'/> Amount</label>
            <label class='inline-flex items-center text-sm text-gray-700'><input type='checkbox' class='mr-2'/> Delivery Date</label>
            <label class='inline-flex items-center text-sm text-gray-700'><input type='checkbox' class='mr-2'/> Items/Qty</label>
            <label class='inline-flex items-center text-sm text-gray-700'><input type='checkbox' class='mr-2'/> Vendor Terms</label>
          </div>
          <div>
            <label class='block text-sm font-medium text-gray-700 mb-1'>Details</label>
            <textarea class='w-full border rounded-lg p-2' rows='3' placeholder='Describe the changes required'></textarea>
          </div>
          <div>
            <label class='block text-sm font-medium text-gray-700 mb-1'>Revised Deadline</label>
            <input type='date' class='w-full border rounded-lg p-2'/>
          </div>
          <div class='flex justify-end gap-2'>
            <button class='px-3 py-2 border rounded-lg hover:bg-gray-50' onclick='closeModal()'>Cancel</button>
            <button class='px-3 py-2 gradient-purple text-white rounded-lg hover:opacity-90' onclick="finishChangeReq('${p.id}')"><i class='fas fa-pen-to-square mr-2'></i>Send Request</button>
          </div>
        </div>`;
      el('modalTitle').textContent = 'Request Changes'; el('modalBody').innerHTML = body; openModal();
    }

    function finishChangeReq(id){ closeModal(); showToast(`Change request sent for ${id}`,'warning'); }

    function approveChange(id){ showToast(`${id} change approved`,'success'); }
    function rejectChange(id){ showToast(`${id} change rejected`,'info'); }
    function askMore(id){ showToast(`More info requested for ${id}`,'info'); }

    // Filters
    function applyFilters(){ showToast('Filters applied','info'); }
    function resetFilters(){ document.getElementById('fStatus').value=''; document.getElementById('fPriority').value=''; document.getElementById('fDept').value=''; document.getElementById('fVendor').value=''; loadPOs(); showToast('Filters reset','info'); }

    // Modal & Toast
    function openModal(){ el('modal').classList.remove('hidden'); }
    function closeModal(){ el('modal').classList.add('hidden'); }
    function showToast(msg,type='info'){ const t=el('toast'); const c={success:'bg-green-600',info:'bg-blue-600',warning:'bg-yellow-600',error:'bg-red-600'}[type]||'bg-gray-800'; t.className=`fixed top-4 right-4 text-white px-4 py-2 rounded-lg shadow-lg ${c}`; t.textContent=msg; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'),2200); }

    document.addEventListener('DOMContentLoaded', ()=>{
      loadPOs(); loadChangeCards();
      document.addEventListener('keydown', (e)=>{ if(e.altKey && (e.key==='b'||e.key==='B')){ e.preventDefault(); navBack(); } if(e.key==='Escape') closeModal(); });
    });
  </script>
</body>
</html>
