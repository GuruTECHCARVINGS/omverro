<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage ASN - Buyer Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    
    .status-badge {
      @apply px-3 py-1 rounded-full text-xs font-medium;
    }
    
    .status-pending { @apply bg-yellow-100 text-yellow-800; }
    .status-shipped { @apply bg-blue-100 text-blue-800; }
    .status-in-transit { @apply bg-purple-100 text-purple-800; }
    .status-delivered { @apply bg-green-100 text-green-800; }
    .status-delayed { @apply bg-red-100 text-red-800; }
    .status-cancelled { @apply bg-gray-100 text-gray-800; }
    
    .priority-high { @apply bg-red-500; }
    .priority-medium { @apply bg-yellow-500; }
    .priority-low { @apply bg-green-500; }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .hover-scale { transition: transform 0.2s ease-in-out; }
    .hover-scale:hover { transform: scale(1.02); }
    
    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
</head>
<<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-4">
          <button onclick="history.back()" class="text-gray-600 hover:text-gray-900 transition-colors">
            <i class="fas fa-arrow-left text-lg"></i>
          </button>
          <h1 class="text-2xl font-semibold text-gray-900">Manage ASN</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button onclick="exportData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
            <i class="fas fa-download"></i>
            <span>Export</span>
          </button>
          <button onclick="refreshData()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- KPI Dashboard -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-sm p-6 hover-scale">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Total ASNs</p>
            <p class="text-3xl font-bold text-gray-900 mt-1">45</p>
            <p class="text-sm text-green-600 mt-1">
              <i class="fas fa-arrow-up"></i> +12% from last month
            </p>
          </div>
          <div class="bg-blue-100 p-3 rounded-lg">
            <i class="fas fa-shipping-fast text-blue-600 text-xl"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-sm p-6 hover-scale">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">In Transit</p>
            <p class="text-3xl font-bold text-purple-600 mt-1">18</p>
            <p class="text-sm text-gray-500 mt-1">40% of total</p>
          </div>
          <div class="bg-purple-100 p-3 rounded-lg">
            <i class="fas fa-truck text-purple-600 text-xl"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-sm p-6 hover-scale">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Delivered</p>
            <p class="text-3xl font-bold text-green-600 mt-1">22</p>
            <p class="text-sm text-gray-500 mt-1">49% of total</p>
          </div>
          <div class="bg-green-100 p-3 rounded-lg">
            <i class="fas fa-check-circle text-green-600 text-xl"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-sm p-6 hover-scale">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Delayed</p>
            <p class="text-3xl font-bold text-red-600 mt-1">5</p>
            <p class="text-sm text-red-600 mt-1">
              <i class="fas fa-exclamation-triangle"></i> Needs attention
            </p>
          </div>
          <div class="bg-red-100 p-3 rounded-lg">
            <i class="fas fa-clock text-red-600 text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 flex-1">
          <div class="flex-1">
            <div class="relative">
              <input 
                type="text" 
                id="searchInput"
                placeholder="Search ASN, PO, Vendor..." 
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                onkeyup="filterASNs()"
              >
              <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
          </div>
          
          <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterASNs()">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="shipped">Shipped</option>
            <option value="in-transit">In Transit</option>
            <option value="delivered">Delivered</option>
            <option value="delayed">Delayed</option>
            <option value="cancelled">Cancelled</option>
          </select>

          <select id="priorityFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterASNs()">
            <option value="">All Priority</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>

          <input 
            type="date" 
            id="dateFilter"
            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            onchange="filterASNs()"
          >
        </div>
        
        <div class="flex space-x-2">
          <button onclick="clearFilters()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
            <i class="fas fa-times"></i> Clear
          </button>
          <button onclick="openCreateModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
            <i class="fas fa-plus"></i>
            <span>Create ASN</span>
          </button>
        </div>
      </div>
    </div>

    <!-- ASN Table -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('asnNumber')">
                ASN Number
                <i class="fas fa-sort text-gray-400 ml-1"></i>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('poNumber')">
                PO Number
                <i class="fas fa-sort text-gray-400 ml-1"></i>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('vendor')">
                Vendor
                <i class="fas fa-sort text-gray-400 ml-1"></i>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Priority
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('shipDate')">
                Ship Date
                <i class="fas fa-sort text-gray-400 ml-1"></i>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('expectedDate')">
                Expected Delivery
                <i class="fas fa-sort text-gray-400 ml-1"></i>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('totalValue')">
                Total Value
                <i class="fas fa-sort text-gray-400 ml-1"></i>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Status
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Tracking
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200" id="asnTableBody">
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      
      <!-- Pagination -->
      <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
        <div class="flex-1 flex justify-between sm:hidden">
          <button onclick="previousPage()" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Previous
          </button>
          <button onclick="nextPage()" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Next
          </button>
        </div>
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
          <div>
            <p class="text-sm text-gray-700">
              Showing <span class="font-medium" id="showingStart">1</span> to <span class="font-medium" id="showingEnd">10</span> of
              <span class="font-medium" id="totalRecords">45</span> results
            </p>
          </div>
          <div>
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
              <button onclick="previousPage()" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                <span class="sr-only">Previous</span>
                <i class="fas fa-chevron-left"></i>
              </button>
              <div id="paginationNumbers" class="flex">
                <!-- Pagination numbers will be generated by JavaScript -->
              </div>
              <button onclick="nextPage()" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                <span class="sr-only">Next</span>
                <i class="fas fa-chevron-right"></i>
              </button>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View ASN Details Modal -->
  <div id="viewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex min-h-screen items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar fade-in">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
          <h3 class="text-xl font-semibold text-gray-900">ASN Details</h3>
          <button onclick="closeModal('viewModal')" class="text-gray-400 hover:text-gray-600 transition-colors">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="p-6">
          <div id="viewModalContent">
            <!-- Content will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create ASN Modal -->
  <div id="createModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex min-h-screen items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar fade-in">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
          <h3 class="text-xl font-semibold text-gray-900">Create New ASN</h3>
          <button onclick="closeModal('createModal')" class="text-gray-400 hover:text-gray-600 transition-colors">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <form id="createASNForm" class="p-6 space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ASN Number</label>
              <input type="text" name="asnNumber" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Auto-generated">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">PO Number*</label>
              <select name="poNumber" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Select PO Number</option>
                <option value="PO-2024-001">PO-2024-001</option>
                <option value="PO-2024-002">PO-2024-002</option>
                <option value="PO-2024-003">PO-2024-003</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Vendor*</label>
              <select name="vendor" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Select Vendor</option>
                <option value="Acme Corporation">Acme Corporation</option>
                <option value="Global Tech Solutions">Global Tech Solutions</option>
                <option value="Prime Industries">Prime Industries</option>
                <option value="Advanced Materials Inc">Advanced Materials Inc</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Priority*</label>
              <select name="priority" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Select Priority</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ship Date*</label>
              <input type="date" name="shipDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Expected Delivery*</label>
              <input type="date" name="expectedDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Carrier</label>
              <input type="text" name="carrier" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., FedEx, UPS, DHL">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tracking Number</label>
              <input type="text" name="trackingNumber" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter tracking number">
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
            <textarea name="instructions" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Any special handling or delivery instructions..."></textarea>
          </div>

          <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
            <button type="button" onclick="closeModal('createModal')" class="px-6 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
              Cancel
            </button>
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              <i class="fas fa-plus mr-2"></i>Create ASN
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit ASN Modal -->
  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex min-h-screen items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar fade-in">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
          <h3 class="text-xl font-semibold text-gray-900">Edit ASN</h3>
          <button onclick="closeModal('editModal')" class="text-gray-400 hover:text-gray-600 transition-colors">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <form id="editASNForm" class="p-6 space-y-6">
          <div id="editModalContent">
            <!-- Content will be populated by JavaScript -->
          </div>
          <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
            <button type="button" onclick="closeModal('editModal')" class="px-6 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
              Cancel
            </button>
            <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
              <i class="fas fa-save mr-2"></i>Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Pricing Details Modal -->
  <div id="pricingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex min-h-screen items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar fade-in">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
          <h3 class="text-xl font-semibold text-gray-900">Pricing Analysis</h3>
          <button onclick="closeModal('pricingModal')" class="text-gray-400 hover:text-gray-600 transition-colors">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="p-6">
          <div id="pricingModalContent">
            <!-- Content will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex min-h-screen items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-md w-full fade-in">
        <div class="p-6 text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-check text-green-600 text-2xl"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Success!</h3>
          <p id="successMessage" class="text-gray-600 mb-6"></p>
          <button onclick="closeModal('successModal')" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
            OK
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sample ASN data
    let asnData = [
      {
        id: 1,
        asnNumber: 'ASN-2024-001',
        poNumber: 'PO-2024-001',
        vendor: 'Acme Corporation',
        priority: 'high',
        shipDate: '2024-08-15',
        expectedDate: '2024-08-18',
        actualDate: null,
        status: 'shipped',
        carrier: 'FedEx',
        trackingNumber: 'FX123456789',
        items: [
          { 
            description: 'Industrial Bearings - SKU: IB-2024-100', 
            quantity: 100, 
            unitPrice: 2075.00,
            poUnitPrice: 2240.00,
            savings: 165.00,
            category: 'Mechanical Components'
          },
          { 
            description: 'Steel Brackets - SKU: SB-2024-050', 
            quantity: 50, 
            unitPrice: 1245.00,
            poUnitPrice: 1245.00,
            savings: 0.00,
            category: 'Structural Components'
          }
        ],
        totalValue: 269750.00,
        poTotalValue: 286250.00,
        totalSavings: 16500.00,
        instructions: 'Handle with care - fragile items',
        currency: 'INR',
        paymentTerms: 'Net 30',
        discount: '3% early payment'
      },
      {
        id: 2,
        asnNumber: 'ASN-2024-002',
        poNumber: 'PO-2024-002',
        vendor: 'Global Tech Solutions',
        priority: 'medium',
        shipDate: '2024-08-20',
        expectedDate: '2024-08-23',
        actualDate: '2024-08-22',
        status: 'delivered',
        carrier: 'UPS',
        trackingNumber: 'UP987654321',
        items: [
          { 
            description: 'Circuit Boards - SKU: CB-2024-025', 
            quantity: 25, 
            unitPrice: 9960.00,
            poUnitPrice: 10375.00,
            savings: 415.00,
            category: 'Electronic Components'
          },
          { 
            description: 'Connectors - SKU: CN-2024-200', 
            quantity: 200, 
            unitPrice: 415.00,
            poUnitPrice: 456.50,
            savings: 41.50,
            category: 'Electronic Components'
          }
        ],
        totalValue: 332000.00,
        poTotalValue: 350687.50,
        totalSavings: 18687.50,
        instructions: 'ESD sensitive components',
        currency: 'INR',
        paymentTerms: 'Net 15',
        discount: '2% bulk order'
      },
      {
        id: 3,
        asnNumber: 'ASN-2024-003',
        poNumber: 'PO-2024-003',
        vendor: 'Prime Industries',
        priority: 'low',
        shipDate: '2024-08-25',
        expectedDate: '2024-08-28',
        actualDate: null,
        status: 'in-transit',
        carrier: 'DHL',
        trackingNumber: 'DH456789123',
        items: [
          { 
            description: 'Raw Materials - Aluminum Sheets - SKU: AL-2024-500', 
            quantity: 500, 
            unitPrice: 664.00,
            poUnitPrice: 684.75,
            savings: 20.75,
            category: 'Raw Materials'
          }
        ],
        totalValue: 332000.00,
        poTotalValue: 342375.00,
        totalSavings: 10375.00,
        instructions: 'Standard delivery',
        currency: 'INR',
        paymentTerms: 'Net 45',
        discount: 'Volume discount applied'
      },
      {
        id: 4,
        asnNumber: 'ASN-2024-004',
        poNumber: 'PO-2024-004',
        vendor: 'Advanced Materials Inc',
        priority: 'high',
        shipDate: '2024-08-10',
        expectedDate: '2024-08-13',
        actualDate: null,
        status: 'delayed',
        carrier: 'FedEx',
        trackingNumber: 'FX789123456',
        items: [
          { 
            description: 'Specialty Alloys - Titanium Grade 2 - SKU: TI-2024-075', 
            quantity: 75, 
            unitPrice: 16600.00,
            poUnitPrice: 17430.00,
            savings: 830.00,
            category: 'Specialty Materials'
          }
        ],
        totalValue: 1245000.00,
        poTotalValue: 1307250.00,
        totalSavings: 62250.00,
        instructions: 'Temperature controlled shipping required',
        currency: 'INR',
        paymentTerms: 'Net 30',
        discount: '5% negotiated rate'
      },
      {
        id: 5,
        asnNumber: 'ASN-2024-005',
        poNumber: 'PO-2024-005',
        vendor: 'Tech Components Ltd',
        priority: 'medium',
        shipDate: '2024-08-22',
        expectedDate: '2024-08-25',
        actualDate: null,
        status: 'pending',
        carrier: 'UPS',
        trackingNumber: 'UP123789456',
        items: [
          { 
            description: 'Electronic Components - Resistors - SKU: RS-2024-150', 
            quantity: 150, 
            unitPrice: 3735.00,
            poUnitPrice: 3984.00,
            savings: 249.00,
            category: 'Electronic Components'
          }
        ],
        totalValue: 560250.00,
        poTotalValue: 597600.00,
        totalSavings: 37350.00,
        instructions: 'Signature required on delivery',
        currency: 'INR',
        paymentTerms: 'Net 30',
        discount: 'First-time buyer discount'
      },
      {
        id: 6,
        asnNumber: 'ASN-2024-006',
        poNumber: 'PO-2024-006',
        vendor: 'Industrial Supply Co',
        priority: 'high',
        shipDate: '2024-08-26',
        expectedDate: '2024-08-29',
        actualDate: null,
        status: 'shipped',
        carrier: 'DHL',
        trackingNumber: 'DH654321789',
        items: [
          { 
            description: 'Machine Parts - Hydraulic Pumps - SKU: HP-2024-030', 
            quantity: 30, 
            unitPrice: 29050.00,
            poUnitPrice: 31087.50,
            savings: 2037.50,
            category: 'Machinery Components'
          }
        ],
        totalValue: 871500.00,
        poTotalValue: 932625.00,
        totalSavings: 61125.00,
        instructions: 'Heavy machinery - use loading dock',
        currency: 'INR',
        paymentTerms: 'Net 30',
        discount: 'Bulk purchase discount'
      }
    ];

    let currentPage = 1;
    let itemsPerPage = 10;
    let filteredData = [...asnData];
    let sortColumn = '';
    let sortDirection = 'asc';

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      renderTable();
      updatePagination();
      updateKPIs();
    });

    // Render table
    function renderTable() {
      const tbody = document.getElementById('asnTableBody');
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const pageData = filteredData.slice(startIndex, endIndex);

      tbody.innerHTML = pageData.map(asn => `
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">${asn.asnNumber}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${asn.poNumber}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${asn.vendor}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="w-2 h-2 rounded-full mr-2 ${getPriorityColor(asn.priority)}"></div>
              <span class="text-sm text-gray-900 capitalize">${asn.priority}</span>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            ${formatDate(asn.shipDate)}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            ${formatDate(asn.expectedDate)}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm">
              <div class="text-lg font-semibold text-green-600">${formatCurrency(asn.totalValue)}</div>
              <div class="text-xs text-gray-500">${asn.items.length} item${asn.items.length > 1 ? 's' : ''}</div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="status-badge ${getStatusClass(asn.status)}">
              ${formatStatus(asn.status)}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm">
              <div class="text-gray-900">${asn.carrier}</div>
              <div class="text-gray-500">${asn.trackingNumber}</div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <div class="flex space-x-2">
              <button onclick="viewASN(${asn.id})" class="text-blue-600 hover:text-blue-900 transition-colors" title="View Details & Pricing">
                <i class="fas fa-eye"></i>
              </button>
              <button onclick="viewPricing(${asn.id})" class="text-indigo-600 hover:text-indigo-900 transition-colors" title="View Pricing Details">
                <i class="fas fa-dollar-sign"></i>
              </button>
              <button onclick="editASN(${asn.id})" class="text-green-600 hover:text-green-900 transition-colors" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick="trackASN('${asn.trackingNumber}', '${asn.carrier}')" class="text-purple-600 hover:text-purple-900 transition-colors" title="Track Shipment">
                <i class="fas fa-map-marker-alt"></i>
              </button>
              <button onclick="deleteASN(${asn.id})" class="text-red-600 hover:text-red-900 transition-colors" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Helper functions for styling
    function getPriorityColor(priority) {
      switch(priority) {
        case 'high': return 'bg-red-500';
        case 'medium': return 'bg-yellow-500';
        case 'low': return 'bg-green-500';
        default: return 'bg-gray-500';
      }
    }

    function getStatusClass(status) {
      return `status-${status.replace(/[\s-]/g, '-').toLowerCase()}`;
    }

    function formatStatus(status) {
      return status.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    // Format currency in Indian Rupees
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
      }).format(amount);
    }

    // Format number in Indian numbering system
    function formatIndianNumber(amount) {
      return new Intl.NumberFormat('en-IN').format(amount);
    }

    // Filtering
    function filterASNs() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value;
      const priorityFilter = document.getElementById('priorityFilter').value;
      const dateFilter = document.getElementById('dateFilter').value;

      filteredData = asnData.filter(asn => {
        const matchesSearch = !searchTerm || 
          asn.asnNumber.toLowerCase().includes(searchTerm) ||
          asn.poNumber.toLowerCase().includes(searchTerm) ||
          asn.vendor.toLowerCase().includes(searchTerm) ||
          asn.carrier.toLowerCase().includes(searchTerm);

        const matchesStatus = !statusFilter || asn.status === statusFilter;
        const matchesPriority = !priorityFilter || asn.priority === priorityFilter;
        const matchesDate = !dateFilter || asn.shipDate === dateFilter;

        return matchesSearch && matchesStatus && matchesPriority && matchesDate;
      });

      currentPage = 1;
      renderTable();
      updatePagination();
    }

    // Clear filters
    function clearFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('priorityFilter').value = '';
      document.getElementById('dateFilter').value = '';
      
      filteredData = [...asnData];
      currentPage = 1;
      renderTable();
      updatePagination();
    }

    // Sorting
    function sortTable(column) {
      if (sortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDirection = 'asc';
      }

      filteredData.sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];

        if (column === 'shipDate' || column === 'expectedDate') {
          aVal = new Date(aVal);
          bVal = new Date(bVal);
        }

        if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
        if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
        return 0;
      });

      renderTable();
    }

    // Pagination
    function updatePagination() {
      const totalItems = filteredData.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const startIndex = (currentPage - 1) * itemsPerPage + 1;
      const endIndex = Math.min(startIndex + itemsPerPage - 1, totalItems);

      document.getElementById('showingStart').textContent = startIndex;
      document.getElementById('showingEnd').textContent = endIndex;
      document.getElementById('totalRecords').textContent = totalItems;

      // Generate pagination numbers
      const paginationNumbers = document.getElementById('paginationNumbers');
      paginationNumbers.innerHTML = '';

      for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement('button');
        button.textContent = i;
        button.className = `relative inline-flex items-center px-4 py-2 border text-sm font-medium ${
          i === currentPage 
            ? 'z-10 bg-blue-50 border-blue-500 text-blue-600' 
            : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'
        }`;
        button.onclick = () => goToPage(i);
        paginationNumbers.appendChild(button);
      }
    }

    function goToPage(page) {
      currentPage = page;
      renderTable();
      updatePagination();
    }

    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
        updatePagination();
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderTable();
        updatePagination();
      }
    }

    // Modal functions
    function openModal(modalId) {
      document.getElementById(modalId).classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    // ASN operations
    function viewASN(id) {
      const asn = asnData.find(a => a.id === id);
      if (!asn) return;

      const content = document.getElementById('viewModalContent');
      content.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-600">ASN Number</label>
              <p class="text-lg font-semibold text-gray-900">${asn.asnNumber}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">PO Number</label>
              <p class="text-gray-900">${asn.poNumber}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Vendor</label>
              <p class="text-gray-900">${asn.vendor}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Priority</label>
              <div class="flex items-center">
                <div class="w-3 h-3 rounded-full mr-2 ${getPriorityColor(asn.priority)}"></div>
                <span class="capitalize">${asn.priority}</span>
              </div>
            </div>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-600">Status</label>
              <span class="status-badge ${getStatusClass(asn.status)}">
                ${formatStatus(asn.status)}
              </span>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Ship Date</label>
              <p class="text-gray-900">${formatDate(asn.shipDate)}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Expected Delivery</label>
              <p class="text-gray-900">${formatDate(asn.expectedDate)}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600">Carrier & Tracking</label>
              <p class="text-gray-900">${asn.carrier} - ${asn.trackingNumber}</p>
            </div>
          </div>
        </div>

        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-600 mb-2">Line Items & Pricing</label>
          <div class="bg-gray-50 rounded-lg p-4">
            <table class="w-full">
              <thead>
                <tr class="text-left text-sm font-medium text-gray-600">
                  <th class="pb-2">Description</th>
                  <th class="pb-2">Quantity</th>
                  <th class="pb-2">Unit Price</th>
                  <th class="pb-2">PO Price</th>
                  <th class="pb-2">Savings</th>
                  <th class="pb-2">Total</th>
                </tr>
              </thead>
              <tbody class="text-sm">
                ${asn.items.map(item => `
                  <tr class="border-t border-gray-200">
                    <td class="py-2">
                      <div class="font-medium">${item.description.split(' - ')[0]}</div>
                      ${item.description.includes('SKU:') ? `<div class="text-xs text-gray-500">${item.description.split(' - ')[1]}</div>` : ''}
                      <div class="text-xs text-blue-600">${item.category}</div>
                    </td>
                    <td class="py-2">${item.quantity}</td>
                    <td class="py-2">
                      <div class="font-semibold text-green-600">${formatCurrency(item.unitPrice)}</div>
                    </td>
                    <td class="py-2">
                      <div class="text-gray-600">${formatCurrency(item.poUnitPrice)}</div>
                    </td>
                    <td class="py-2">
                      ${item.savings > 0 ? 
                        `<div class="text-green-600 font-medium">${formatCurrency(item.savings)}</div>` : 
                        `<div class="text-gray-400">--</div>`}
                    </td>
                    <td class="py-2">
                      <div class="font-semibold">${formatCurrency(item.quantity * item.unitPrice)}</div>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
              <tfoot class="border-t-2 border-gray-300">
                <tr class="font-semibold text-base">
                  <td colspan="4" class="py-2">Total Value:</td>
                  <td class="py-2 text-green-600">${formatCurrency(asn.totalSavings)}</td>
                  <td class="py-2 text-lg">${formatCurrency(asn.totalValue)}</td>
                </tr>
                ${asn.totalSavings > 0 ? `
                  <tr class="text-sm text-gray-600">
                    <td colspan="4" class="py-1">Original PO Total:</td>
                    <td class="py-1">Total Savings:</td>
                    <td class="py-1 line-through">${formatCurrency(asn.poTotalValue)}</td>
                  </tr>
                ` : ''}
              </tfoot>
            </table>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="bg-blue-50 p-4 rounded-lg">
            <div class="text-sm text-blue-600 font-medium">Payment Terms</div>
            <div class="text-lg font-semibold text-blue-900">${asn.paymentTerms}</div>
          </div>
          <div class="bg-green-50 p-4 rounded-lg">
            <div class="text-sm text-green-600 font-medium">Discount Applied</div>
            <div class="text-lg font-semibold text-green-900">${asn.discount}</div>
          </div>
          <div class="bg-purple-50 p-4 rounded-lg">
            <div class="text-sm text-purple-600 font-medium">Currency</div>
            <div class="text-lg font-semibold text-purple-900">${asn.currency}</div>
          </div>
        </div>

        ${asn.instructions ? `
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-600 mb-2">Special Instructions</label>
            <p class="text-gray-900 bg-blue-50 p-3 rounded-lg">${asn.instructions}</p>
          </div>
        ` : ''}

        <div class="flex justify-end space-x-4">
          <button onclick="trackASN('${asn.trackingNumber}', '${asn.carrier}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-map-marker-alt mr-2"></i>Track Shipment
          </button>
          <button onclick="editASN(${asn.id})" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
            <i class="fas fa-edit mr-2"></i>Edit ASN
          </button>
        </div>
      `;

      openModal('viewModal');
    }

    function viewPricing(id) {
      const asn = asnData.find(a => a.id === id);
      if (!asn) return;

      const content = document.getElementById('pricingModalContent');
      content.innerHTML = `
        <div class="mb-8">
          <div class="flex justify-between items-center mb-4">
            <div>
              <h4 class="text-lg font-semibold text-gray-900">${asn.asnNumber} - Pricing Analysis</h4>
              <p class="text-gray-600">${asn.vendor} | ${asn.poNumber}</p>
            </div>
            <div class="text-right">
              <div class="text-2xl font-bold text-green-600">${formatCurrency(asn.totalValue)}</div>
              ${asn.totalSavings > 0 ? `<div class="text-sm text-green-600">Saved ${formatCurrency(asn.totalSavings)}</div>` : ''}
            </div>
          </div>

          <!-- Pricing Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-blue-50 p-4 rounded-lg text-center">
              <div class="text-2xl font-bold text-blue-600">${formatCurrency(asn.totalValue)}</div>
              <div class="text-sm text-blue-800">Final Total</div>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg text-center">
              <div class="text-2xl font-bold text-gray-600">${formatCurrency(asn.poTotalValue)}</div>
              <div class="text-sm text-gray-800">Original PO</div>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-center">
              <div class="text-2xl font-bold text-green-600">${formatCurrency(asn.totalSavings)}</div>
              <div class="text-sm text-green-800">Total Savings</div>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg text-center">
              <div class="text-2xl font-bold text-purple-600">${((asn.totalSavings / asn.poTotalValue) * 100).toFixed(1)}%</div>
              <div class="text-sm text-purple-800">Savings Rate</div>
            </div>
          </div>
        </div>

        <!-- Detailed Pricing Table -->
        <div class="mb-6">
          <h5 class="text-lg font-semibold text-gray-900 mb-4">Detailed Item Pricing</h5>
          <div class="overflow-x-auto">
            <table class="w-full border border-gray-200 rounded-lg">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Item Details</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">PO Unit Price</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Final Unit Price</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Unit Savings</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Line Total</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Line Savings</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                ${asn.items.map(item => {
                  const lineSavings = item.quantity * item.savings;
                  const savingsPercent = item.poUnitPrice > 0 ? ((item.savings / item.poUnitPrice) * 100).toFixed(1) : 0;
                  return `
                    <tr class="hover:bg-gray-50">
                      <td class="px-4 py-3">
                        <div class="font-medium text-gray-900">${item.description.split(' - SKU:')[0]}</div>
                        ${item.description.includes('SKU:') ? 
                          `<div class="text-sm text-gray-500">SKU: ${item.description.split('SKU: ')[1]}</div>` : ''}
                        <div class="text-xs text-blue-600 mt-1">${item.category}</div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-900">${item.quantity}</td>
                      <td class="px-4 py-3">
                        <div class="text-sm text-gray-600">${formatCurrency(item.poUnitPrice)}</div>
                      </td>
                      <td class="px-4 py-3">
                        <div class="text-sm font-semibold text-green-600">${formatCurrency(item.unitPrice)}</div>
                      </td>
                      <td class="px-4 py-3">
                        ${item.savings > 0 ? 
                          `<div class="text-sm font-medium text-green-600">${formatCurrency(item.savings)} (${savingsPercent}%)</div>` :
                          `<div class="text-sm text-gray-400">No savings</div>`}
                      </td>
                      <td class="px-4 py-3">
                        <div class="text-sm font-semibold text-gray-900">${formatCurrency(item.quantity * item.unitPrice)}</div>
                      </td>
                      <td class="px-4 py-3">
                        ${lineSavings > 0 ? 
                          `<div class="text-sm font-medium text-green-600">${formatCurrency(lineSavings)}</div>` :
                          `<div class="text-sm text-gray-400">â‚¹0.00</div>`}
                      </td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Payment & Terms Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div class="bg-white border border-gray-200 rounded-lg p-4">
            <h6 class="font-semibold text-gray-900 mb-3">Payment Terms</h6>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-600">Terms:</span>
                <span class="font-medium">${asn.paymentTerms}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Currency:</span>
                <span class="font-medium">${asn.currency}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Discount:</span>
                <span class="font-medium text-green-600">${asn.discount}</span>
              </div>
            </div>
          </div>
          
          <div class="bg-white border border-gray-200 rounded-lg p-4">
            <h6 class="font-semibold text-gray-900 mb-3">Cost Analysis</h6>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-600">Items Count:</span>
                <span class="font-medium">${asn.items.length}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Avg. Unit Savings:</span>
                <span class="font-medium text-green-600">${formatCurrency(asn.totalSavings / asn.items.reduce((sum, item) => sum + item.quantity, 0))}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Savings Rate:</span>
                <span class="font-medium text-green-600">${((asn.totalSavings / asn.poTotalValue) * 100).toFixed(1)}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Price Comparison Chart (Visual representation) -->
        <div class="mb-6">
          <h6 class="font-semibold text-gray-900 mb-3">Price Comparison Overview</h6>
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="space-y-3">
              ${asn.items.map(item => {
                const savingsPercent = item.poUnitPrice > 0 ? (item.savings / item.poUnitPrice) * 100 : 0;
                const finalPercent = item.poUnitPrice > 0 ? (item.unitPrice / item.poUnitPrice) * 100 : 100;
                return `
                  <div class="bg-white p-3 rounded border">
                    <div class="flex justify-between items-center mb-2">
                      <span class="text-sm font-medium">${item.description.split(' - SKU:')[0]}</span>
                      <span class="text-xs text-gray-500">${savingsPercent.toFixed(1)}% savings</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-6 relative">
                      <div class="bg-green-500 h-6 rounded-full" style="width: ${finalPercent}%"></div>
                      <div class="absolute inset-0 flex items-center justify-between px-2 text-xs text-white font-medium">
                        <span>Final: ${formatCurrency(item.unitPrice)}</span>
                        <span>PO: ${formatCurrency(item.poUnitPrice)}</span>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </div>

        <div class="flex justify-end space-x-4">
          <button onclick="exportPricingData(${asn.id})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-download mr-2"></i>Export Pricing
          </button>
          <button onclick="closeModal('pricingModal'); viewASN(${asn.id})" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
            <i class="fas fa-eye mr-2"></i>View Full ASN
          </button>
        </div>
      `;

      openModal('pricingModal');
    }

    function openCreateModal() {
      // Generate next ASN number
      const nextId = asnData.length > 0 ? Math.max(...asnData.map(a => a.id)) + 1 : 1;
      const nextASNNumber = `ASN-2024-${String(nextId).padStart(3, '0')}`;
      
      document.querySelector('input[name="asnNumber"]').value = nextASNNumber;
      openModal('createModal');
    }

    function editASN(id) {
      const asn = asnData.find(a => a.id === id);
      if (!asn) return;

      const content = document.getElementById('editModalContent');
      content.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ASN Number</label>
            <input type="text" name="asnNumber" value="${asn.asnNumber}" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">PO Number</label>
            <input type="text" name="poNumber" value="${asn.poNumber}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Vendor</label>
            <input type="text" name="vendor" value="${asn.vendor}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
            <select name="priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <option value="high" ${asn.priority === 'high' ? 'selected' : ''}>High</option>
              <option value="medium" ${asn.priority === 'medium' ? 'selected' : ''}>Medium</option>
              <option value="low" ${asn.priority === 'low' ? 'selected' : ''}>Low</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ship Date</label>
            <input type="date" name="shipDate" value="${asn.shipDate}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Expected Delivery</label>
            <input type="date" name="expectedDate" value="${asn.expectedDate}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Carrier</label>
            <input type="text" name="carrier" value="${asn.carrier || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tracking Number</label>
            <input type="text" name="trackingNumber" value="${asn.trackingNumber || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
            <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <option value="pending" ${asn.status === 'pending' ? 'selected' : ''}>Pending</option>
              <option value="shipped" ${asn.status === 'shipped' ? 'selected' : ''}>Shipped</option>
              <option value="in-transit" ${asn.status === 'in-transit' ? 'selected' : ''}>In Transit</option>
              <option value="delivered" ${asn.status === 'delivered' ? 'selected' : ''}>Delivered</option>
              <option value="delayed" ${asn.status === 'delayed' ? 'selected' : ''}>Delayed</option>
              <option value="cancelled" ${asn.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
            </select>
          </div>
        </div>
        
        <div class="mt-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
          <textarea name="instructions" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">${asn.instructions || ''}</textarea>
        </div>

        <input type="hidden" name="id" value="${asn.id}">
      `;

      openModal('editModal');
    }

    function trackASN(trackingNumber, carrier) {
      // Simulate tracking functionality
      alert(`Tracking ${trackingNumber} with ${carrier}.\n\nStatus: In Transit\nLocation: Distribution Center\nExpected Delivery: Tomorrow`);
    }

    function deleteASN(id) {
      if (confirm('Are you sure you want to delete this ASN? This action cannot be undone.')) {
        asnData = asnData.filter(asn => asn.id !== id);
        filteredData = filteredData.filter(asn => asn.id !== id);
        renderTable();
        updatePagination();
        updateKPIs();
        showSuccess('ASN deleted successfully');
      }
    }

    // Form submissions
    document.getElementById('createASNForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      
      const newASN = {
        id: Math.max(...asnData.map(a => a.id)) + 1,
        asnNumber: formData.get('asnNumber'),
        poNumber: formData.get('poNumber'),
        vendor: formData.get('vendor'),
        priority: formData.get('priority'),
        shipDate: formData.get('shipDate'),
        expectedDate: formData.get('expectedDate'),
        actualDate: null,
        status: 'pending',
        carrier: formData.get('carrier') || 'TBD',
        trackingNumber: formData.get('trackingNumber') || 'TBD',
        items: [{ description: 'Items from ' + formData.get('poNumber'), quantity: 1, unitPrice: 0 }],
        totalValue: 0,
        instructions: formData.get('instructions') || ''
      };

      asnData.push(newASN);
      filteredData = [...asnData];
      renderTable();
      updatePagination();
      updateKPIs();
      closeModal('createModal');
      showSuccess('ASN created successfully');
      this.reset();
    });

    document.getElementById('editASNForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const id = parseInt(formData.get('id'));
      
      const asnIndex = asnData.findIndex(asn => asn.id === id);
      if (asnIndex !== -1) {
        asnData[asnIndex] = {
          ...asnData[asnIndex],
          poNumber: formData.get('poNumber'),
          vendor: formData.get('vendor'),
          priority: formData.get('priority'),
          shipDate: formData.get('shipDate'),
          expectedDate: formData.get('expectedDate'),
          carrier: formData.get('carrier'),
          trackingNumber: formData.get('trackingNumber'),
          status: formData.get('status'),
          instructions: formData.get('instructions')
        };

        filteredData = [...asnData];
        renderTable();
        updateKPIs();
        closeModal('editModal');
        showSuccess('ASN updated successfully');
      }
    });

    function showSuccess(message) {
      document.getElementById('successMessage').textContent = message;
      openModal('successModal');
    }

    // Utility functions
    function updateKPIs() {
      // This would typically fetch real-time data
      // For demo purposes, we'll calculate from our sample data
      const total = asnData.length;
      const inTransit = asnData.filter(asn => asn.status === 'in-transit').length;
      const delivered = asnData.filter(asn => asn.status === 'delivered').length;
      const delayed = asnData.filter(asn => asn.status === 'delayed').length;

      // Update the KPI cards if needed
      // This is a placeholder for real-time KPI updates
    }

    function exportData() {
      // Simple CSV export
      const headers = ['ASN Number', 'PO Number', 'Vendor', 'Priority', 'Ship Date', 'Expected Date', 'Status', 'Carrier', 'Tracking'];
      const csvData = [headers.join(',')];
      
      filteredData.forEach(asn => {
        csvData.push([
          asn.asnNumber,
          asn.poNumber,
          asn.vendor,
          asn.priority,
          asn.shipDate,
          asn.expectedDate,
          asn.status,
          asn.carrier,
          asn.trackingNumber
        ].join(','));
      });

      const csvContent = csvData.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ASN-Export-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function refreshData() {
      // Simulate data refresh
      renderTable();
      updatePagination();
      updateKPIs();
      
      // Show temporary loading state
      const refreshBtn = event.target;
      const icon = refreshBtn.querySelector('i');
      icon.classList.add('fa-spin');
      setTimeout(() => {
        icon.classList.remove('fa-spin');
      }, 1000);
    }

    // Close modals with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const modals = ['viewModal', 'createModal', 'editModal', 'successModal', 'pricingModal'];
        modals.forEach(modalId => {
          const modal = document.getElementById(modalId);
          if (!modal.classList.contains('hidden')) {
            closeModal(modalId);
          }
        });
      }
    });

    function exportPricingData(id) {
      const asn = asnData.find(a => a.id === id);
      if (!asn) return;

      const headers = [
        'ASN Number', 'PO Number', 'Vendor', 'Item Description', 'SKU', 'Category',
        'Quantity', 'PO Unit Price', 'Final Unit Price', 'Unit Savings', 
        'Line Total', 'Line Savings', 'Payment Terms', 'Currency', 'Discount'
      ];
      
      const csvData = [headers.join(',')];
      
      asn.items.forEach(item => {
        const lineSavings = item.quantity * item.savings;
        const lineTotal = item.quantity * item.unitPrice;
        const sku = item.description.includes('SKU:') ? item.description.split('SKU: ')[1] : '';
        const description = item.description.split(' - SKU:')[0];
        
        csvData.push([
          asn.asnNumber,
          asn.poNumber,
          asn.vendor,
          `"${description}"`,
          sku,
          item.category,
          item.quantity,
          item.poUnitPrice.toFixed(2),
          item.unitPrice.toFixed(2),
          item.savings.toFixed(2),
          lineTotal.toFixed(2),
          lineSavings.toFixed(2),
          asn.paymentTerms,
          asn.currency,
          `"${asn.discount}"`
        ].join(','));
      });

      const csvContent = csvData.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${asn.asnNumber}-Pricing-Analysis-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>